"""
Zoopla MCP Server

使用 FastMCP 的 from_openapi 方法自动生成

Version: 1.0.0
Transport: stdio
"""
import os
import json
import httpx
from fastmcp import FastMCP

# 服务器版本和配置
__version__ = "1.0.0"
__tag__ = "zoopla/1.0.0"

# API 配置
API_KEY = os.getenv("API_KEY", "")

# 传输协议配置
TRANSPORT = "stdio"


# OpenAPI 规范
OPENAPI_SPEC = """{\n  \"openapi\": \"3.0.0\",\n  \"info\": {\n    \"title\": \"Zoopla\",\n    \"version\": \"1.0.0\",\n    \"description\": \"RapidAPI: apidojo/zoopla\"\n  },\n  \"servers\": [\n    {\n      \"url\": \"https://zoopla.p.rapidapi.com\"\n    }\n  ],\n  \"paths\": {\n    \"/properties/v2/list\": {\n      \"get\": {\n        \"summary\": \"properties/v2/list\",\n        \"description\": \"List properties for sale or rent with options and filters\",\n        \"operationId\": \"properties/v2/list\",\n        \"parameters\": [\n          {\n            \"name\": \"locationValue\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of geoLabel field returned in .../v2/auto-complete endpoint with listings as search_type. Or the value of name field returned in .../house-prices/v2/get-area (If you are searching by postal code). You must use EXACTLY the value returned by the endpoint. *'listing_id' OR 'area' parameter must be provided to get this endpoint working.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"locationIdentifier\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of geoIdentifier field returned in .../v2/auto-complete endpoint with listings as search_type. Or the value of id field returned in ..../house-prices/v2/get-area endpoint (If you are searching by postal code). You must use EXACTLY the value returned by the endpoint.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"category\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following residential|commercial\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"furnishedState\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following : Any|furnished|part_furnished|unfurnished\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"includeRented\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Example value: \",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"includeRetirementHomes\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Example value: \",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"includeSharedAccommodation\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Example value: \",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"includeSharedOwnership\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Example value: \",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"includeSold\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Example value: \",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"isAuction\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Example value: \",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"petsAllowed\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Example value: \",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"billsIncluded\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Example value: \",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"keywords\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Any word or term, ex : garden,wooden floors\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"section\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following : for-sale|to-rent\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"bedsMax\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Max number of bed rooms (1 - 10)\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"0\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"bedsMin\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Min number of bed rooms (1 - 10)\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"0\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"priceMax\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Maximum sale or rent price\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"0\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"priceMin\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Minimum sale or rent price\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"0\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"sortOrder\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following : newest_listings|highest_price|lowest_price|most_reduced\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"page\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"The page index for paging purpose\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"1\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"radius\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"The radius (miles) to look for properties (0.25 - 40)\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"0\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"priceFrequency\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following per_month|per_year\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"newHomes\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following : only|exclude\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"added\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Recently added. One of the following : 24_hours|3_days|7_days|14_days|30_days\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"propertySubType\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Filter properties by category. Ignore OR one of the followings (Separated by comma for multiple options) : park_home,bungalow,farms_land,terraced,flats,semi_detached,detached\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"chainFree\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Example value: \",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"reducedPriceOnly\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Example value: \",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"feature\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the followings : has_balcony_terrace|has_parking_garage|has_garden . Separated by comma for multiple options. Ex : has_balcony_terrace,has_parking_garage,...\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"tenure\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the followings : share_of_freehold|freehold|leasehold. Ex : freehold,leasehold,...\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"smartTags\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the followings : condition.needs_modernisation|architecture.period_property|type.cottage|style.modern|attributes.utility_room|attributes.basement|attributes.conservatory|attributes.home_office|attributes.bath|attributes.en_suite|attributes.patio|attributes.kitchen_island. Ex : condition.needs_modernisation,architecture.period_property,...\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/house-prices/v2/estimate\": {\n      \"get\": {\n        \"summary\": \"house-prices/v2/estimate\",\n        \"description\": \"Returned list of estimated house prices\",\n        \"operationId\": \"house_prices/v2/estimate\",\n        \"parameters\": [\n          {\n            \"name\": \"geoIdentifier\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of 'urlPath' field returned in .../house-prices/v2/auto-complete endpoint OR the value of 'id' field returned in .../house-prices/v2/get-area endpoint.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"after\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"The offset to ignore for paging purpose.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"0\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"first\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"The number of items per response\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"20\",\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/agents/detail\": {\n      \"get\": {\n        \"summary\": \"agents/detail\",\n        \"description\": \"Get detailed information of an agent by id\",\n        \"operationId\": \"agents/detail\",\n        \"parameters\": [\n          {\n            \"name\": \"id\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of id field returned in .../agents/list endpoint\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"55447\",\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/agents/list\": {\n      \"get\": {\n        \"summary\": \"agents/list\",\n        \"description\": \"List agents with filters and options\",\n        \"operationId\": \"agents/list\",\n        \"parameters\": [\n          {\n            \"name\": \"location\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of geoIdentifier field returned in .../v2/auto-complete endpoint with listings as search_type. Or the value of id field returned in ..../house-prices/v2/get-area endpoint (If you are searching by postal code). You must use EXACTLY the value returned by the endpoint.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"search_type\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the followings : estate-agents|letting-agents|commercial-agents\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"company_name\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Search by agent name. Either 'location' or 'company_name' is required. You can ignore 'location' parameter when passing value into 'company_name' parameter.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"agents_sort\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following : a_z|lowest_avg_price|highest_avg_price|shortest_avg_age|longest_avg_age\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"pn\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"The page index for paging purpose\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"1\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"radius\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"The radius (miles) to look for agents (0.25 - 40)\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"0\",\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/house-prices/get-area-stats\": {\n      \"get\": {\n        \"summary\": \"house-prices/get-area-stats (Deprecated)\",\n        \"description\": \"Get area stats\",\n        \"operationId\": \"house_prices/get_area_stats_(deprecated)\",\n        \"parameters\": [\n          {\n            \"name\": \"property_id\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of property_id field returned in .../house-prices/estimate endpoint.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"27175510\",\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/house-prices/get-historic-listings\": {\n      \"get\": {\n        \"summary\": \"house-prices/get-historic-listings (Deprecated)\",\n        \"description\": \"Get historic listings\",\n        \"operationId\": \"house_prices/get_historic_listings_(deprecated)\",\n        \"parameters\": [\n          {\n            \"name\": \"property_id\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of property_id field returned in .../house-prices/estimate endpoint.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"27175510\",\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/house-prices/v2/get-area\": {\n      \"get\": {\n        \"summary\": \"house-prices/v2/get-area\",\n        \"description\": \"Use along with .../house-prices/v2/auto-complete endpoint to get related geo id. For example, geo id of postal code.\",\n        \"operationId\": \"house_prices/v2/get_area\",\n        \"parameters\": [\n          {\n            \"name\": \"geoString\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"Postal code, city, district, ward, area, etc.... Use exact values returned in .../house-prices/v2/auto-complete endpoint for best result\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/house-prices/get-running-costs\": {\n      \"get\": {\n        \"summary\": \"house-prices/get-running-costs (Deprecated)\",\n        \"description\": \"Get running costs\",\n        \"operationId\": \"house_prices/get_running_costs_(deprecated)\",\n        \"parameters\": [\n          {\n            \"name\": \"property_id\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of property_id field returned in .../house-prices/estimate endpoint.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"27175510\",\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/house-prices/get-market-activity\": {\n      \"get\": {\n        \"summary\": \"house-prices/get-market-activity (Deprecated)\",\n        \"description\": \"Get market activity in an area\",\n        \"operationId\": \"house_prices/get_market_activity_(deprecated)\",\n        \"parameters\": [\n          {\n            \"name\": \"identifier\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"The value of suggestions/identifier json object returned in .../auto-complete endpoint with properties as search_type. You must use EXACTLY the value returned by the endpoint.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"area\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of suggestions/value json object returned in .../auto-complete endpoint with properties as search_type. You must use EXACTLY the value returned by the endpoint.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/house-prices/get-sales-history\": {\n      \"get\": {\n        \"summary\": \"house-prices/get-sales-history (Deprecated)\",\n        \"description\": \"Get sales history\",\n        \"operationId\": \"house_prices/get_sales_history_(deprecated)\",\n        \"parameters\": [\n          {\n            \"name\": \"property_id\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of property_id field returned in .../house-prices/estimate endpoint.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"27175510\",\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/properties/get-nearby\": {\n      \"get\": {\n        \"summary\": \"properties/get-nearby (Deprecated)\",\n        \"description\": \"Get nearest points of interest\",\n        \"operationId\": \"properties/get_nearby_(deprecated)\",\n        \"parameters\": [\n          {\n            \"name\": \"listing_id\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of listing_id field returned in .../properties/list endpoint\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"56354192\",\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/properties/v2/detail\": {\n      \"get\": {\n        \"summary\": \"properties/v2/detail\",\n        \"description\": \"Get property detail\",\n        \"operationId\": \"properties/v2/detail\",\n        \"parameters\": [\n          {\n            \"name\": \"listingId\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of listingId field returned in .../properties/v2/list endpoint\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"64576476\",\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/properties/get-broadband\": {\n      \"get\": {\n        \"summary\": \"properties/get-broadband (Deprecated)\",\n        \"description\": \"Get broadband information\",\n        \"operationId\": \"properties/get_broadband_(deprecated)\",\n        \"parameters\": [\n          {\n            \"name\": \"listing_id\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of listing_id field returned in .../properties/list endpoint\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"56354192\",\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/properties/get-running-costs\": {\n      \"get\": {\n        \"summary\": \"properties/get-running-costs (Deprecated)\",\n        \"description\": \"Get running costs\",\n        \"operationId\": \"properties/get_running_costs_(deprecated)\",\n        \"parameters\": [\n          {\n            \"name\": \"listing_id\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of listing_id field returned in .../properties/list endpoint\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"56354192\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"category\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following residential|commercial\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"section\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following for-sale|to-rent\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/properties/list\": {\n      \"get\": {\n        \"summary\": \"properties/list (Deprecated)\",\n        \"description\": \"List properties for sale or rent with options and filters\",\n        \"operationId\": \"properties/list_(deprecated)\",\n        \"parameters\": [\n          {\n            \"name\": \"area\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of suggestions/value json object returned in .../auto-complete endpoint with listings as search_type. You must use EXACTLY the value returned by the endpoint. *'listing_id' OR 'area' parameter must be provided to get this endpoint working.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"identifier\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"The value of suggestions/identifier json object returned in .../auto-complete endpoint with listings as search_type. You must use EXACTLY the value returned by the endpoint.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"listing_id\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"The value of listing_id field returned right in this endpoint. *'listing_id' OR 'area' parameter must be provided to get this endpoint working.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"category\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following residential|commercial\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"created_since\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"The date time from which properties added. The format must be yyyy-MM-dd HH:mm:ss, Ex : 2020-09-16 15:00:00\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"furnished\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following furnished|part_furnished|unfurnished\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"include_featured_properties\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following 1 | 0\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"0\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"include_rented\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following 1 | 0\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"0\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"include_retirement_homes\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following yes | no\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"include_shared_accommodation\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following yes | no\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"include_shared_ownership\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following yes | no\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"include_sold\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following 1 | 0\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"0\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"keywords\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Any word or term, ex : garden,wooden floors\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"listing_status\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following sale | rent\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"maximum_beds\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Max number of bed rooms (1 - 10)\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"0\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"minimum_beds\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Min number of bed rooms (1 - 10)\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"0\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"maximum_price\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Maximum sale or rent price\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"0\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"minimum_price\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Minimum sale or rent price\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"0\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"order_by\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following age|price|price_change|view_count\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"ordering\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following ascending|descending\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"page_number\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"The page index for paging purpose\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"1\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"page_size\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"The number of items per response (max 40)\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"40\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"property_type\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following and separated by comma for multiple values : flats|farms_land|terraced|semi_detached|detached|bungalow|park_home|offices|retail|industrial|hospitality|land\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"radius\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"The radius (miles) to look for properties (1 - 40)\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"0\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"pets_allowed\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following yes | no\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"price_frequency\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following per_month|per_year\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"step_back_used\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following 1 | 0\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"0\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"bills_included\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following yes | no\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"floor_area_max\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Maximum floor area, only use with commercial category.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"0\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"floor_area_min\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"Minimum floor area, only use with commercial category.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"0\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"floor_area_units\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following sq_feet|sq_metres\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"new_homes\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following yes | no\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/properties/get-area-stats\": {\n      \"get\": {\n        \"summary\": \"properties/get-area-stats (Deprecated)\",\n        \"description\": \"Get area stats\",\n        \"operationId\": \"properties/get_area_stats_(deprecated)\",\n        \"parameters\": [\n          {\n            \"name\": \"listing_id\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of listing_id field returned in .../properties/list endpoint\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"56354192\",\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/v2/auto-complete\": {\n      \"get\": {\n        \"summary\": \"v2/auto-complete\",\n        \"description\": \"Get auto complete suggestion by term or phrase\",\n        \"operationId\": \"v2/auto_complete\",\n        \"parameters\": [\n          {\n            \"name\": \"locationPrefix\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"Example value: greenwich\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/auto-complete\": {\n      \"get\": {\n        \"summary\": \"auto-complete (Deprecated)\",\n        \"description\": \"Get auto complete suggestion by term or phrase\",\n        \"operationId\": \"auto_complete_(deprecated)\",\n        \"parameters\": [\n          {\n            \"name\": \"search_term\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"Example value: greenwich\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"search_type\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following properties|listings. Use listings value to get suggestion for .../properties/list endpoint. Use properties value to get suggestion for .../house-prices/estimate endpoint.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/house-prices/v2/detail\": {\n      \"get\": {\n        \"summary\": \"house-prices/v2/detail\",\n        \"description\": \"Get property price detailed information\",\n        \"operationId\": \"house_prices/v2/detail\",\n        \"parameters\": [\n          {\n            \"name\": \"uprn\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of \\\"uprn\\\" field returned in .../house-prices/v2/estimate endpoint.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"100061777799\",\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/house-prices/v2/auto-complete\": {\n      \"get\": {\n        \"summary\": \"house-prices/v2/auto-complete\",\n        \"description\": \"Get suggestions by term or phrase about city, country, area,etc...\",\n        \"operationId\": \"house_prices/v2/auto_complete\",\n        \"parameters\": [\n          {\n            \"name\": \"addressPartial\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"City, district, ward, area, etc....\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/house-prices/get-points-of-interest\": {\n      \"get\": {\n        \"summary\": \"house-prices/get-points-of-interest (Deprecated)\",\n        \"description\": \"Get nearest points of interest\",\n        \"operationId\": \"house_prices/get_points_of_interest_(deprecated)\",\n        \"parameters\": [\n          {\n            \"name\": \"property_id\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of property_id field returned in .../house-prices/estimate endpoint.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"27175510\",\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/house-prices/estimate\": {\n      \"get\": {\n        \"summary\": \"house-prices/estimate (Deprecated)\",\n        \"description\": \"Returned list of estimated house prices\",\n        \"operationId\": \"house_prices/estimate_(deprecated)\",\n        \"parameters\": [\n          {\n            \"name\": \"identifier\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"The value of suggestions/identifier json object returned in .../auto-complete endpoint with properties as search_type. You must use EXACTLY the value returned by the endpoint.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"area\",\n            \"in\": \"query\",\n            \"required\": true,\n            \"description\": \"The value of suggestions/value json object returned in .../auto-complete endpoint with properties as search_type. You must use EXACTLY the value returned by the endpoint.\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"order_by\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following price_paid|last_sold|address|estimated_value\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"ordering\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following ascending|descending\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"page_number\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"The page index for paging purpose\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"1\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"page_size\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"The number of items per response (max 40)\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": \"40\",\n              \"enum\": null\n            }\n          },\n          {\n            \"name\": \"property_type\",\n            \"in\": \"query\",\n            \"required\": false,\n            \"description\": \"One of the following detached|flat|terraced|semi_detached\",\n            \"schema\": {\n              \"type\": \"string\",\n              \"default\": null,\n              \"enum\": null\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  \"components\": {\n    \"securitySchemes\": {\n      \"ApiAuth\": {\n        \"type\": \"apiKey\",\n        \"in\": \"header\",\n        \"name\": \"X-RapidAPI-Key\"\n      }\n    }\n  },\n  \"security\": [\n    {\n      \"ApiAuth\": []\n    }\n  ]\n}"""

# 创建 HTTP 客户端
# 设置默认 headers
default_headers = {}


# RapidAPI 必需的 headers
if API_KEY:
    default_headers["X-RapidAPI-Key"] = API_KEY
    default_headers["X-RapidAPI-Host"] = "zoopla.p.rapidapi.com"
else:
    print("⚠️  警告: 未设置 API_KEY 环境变量")
    print("   RapidAPI 需要 API Key 才能正常工作")
    print("   请设置: export API_KEY=你的RapidAPI-Key")

# 对于 POST/PUT/PATCH 请求，自动添加 Content-Type
default_headers["Content-Type"] = "application/json"




client = httpx.AsyncClient(
    base_url="https://zoopla.p.rapidapi.com", 
    timeout=30.0
)


# 从 OpenAPI 规范创建 FastMCP 服务器
openapi_dict = json.loads(OPENAPI_SPEC)
mcp = FastMCP.from_openapi(
    openapi_spec=openapi_dict,
    client=client,
    name="zoopla",
    version=__version__
)


# 注册请求拦截器，为所有请求添加 RapidAPI headers
_original_request = client.request

async def _add_rapidapi_headers(method, url, **kwargs):
    """拦截所有请求，添加必需的 RapidAPI headers"""
    # 确保 headers 存在
    if 'headers' not in kwargs:
        kwargs['headers'] = {}
    
    # 添加 RapidAPI 必需的 headers
    if API_KEY:
        kwargs['headers']['X-RapidAPI-Key'] = API_KEY
        kwargs['headers']['X-RapidAPI-Host'] = "zoopla.p.rapidapi.com"
    else:
        print("⚠️  警告: API_KEY 未设置，请求可能失败")
    
    # 对于 POST/PUT/PATCH，添加 Content-Type
    if method.upper() in ['POST', 'PUT', 'PATCH']:
        if 'Content-Type' not in kwargs['headers']:
            kwargs['headers']['Content-Type'] = 'application/json'
    
    return await _original_request(method, url, **kwargs)

# 替换 request 方法
client.request = _add_rapidapi_headers


def main():
    """主入口点"""
    print(f"🚀 启动 Zoopla MCP 服务器")
    print(f"📦 版本: {__tag__}")
    print(f"🔧 传输协议: {TRANSPORT}")
    
    print()
    
    # 运行服务器
    
    mcp.run(transport="stdio")
    


if __name__ == "__main__":
    main()